{% extends 'base.html.twig' %}

{% block body %}
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
    <div class="container">
      <a class="navbar-brand" href="home">Rendez-Vous<small>Culture</small></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="oi oi-menu"></span> Menu
      </button>
      <div class="collapse navbar-collapse" id="ftco-nav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item "><a href="home" class="nav-link">Acceuil</a></li>
          <li class="nav-item"><a href="rencontre" class="nav-link">Rencontres</a></li>
          <li class="nav-item"><a href="indexService" class="nav-link">Services</a></li>
          <li class="nav-item"><a href="evenement" class="nav-link">Événements</a></li>
          <li class="nav-item"><a href="forum" class="nav-link">Forum</a></li>
          <li class="nav-item"><a href="produit" class="nav-link">Boutique</a></li>
          <li class="nav-item"><a href="contact" class="nav-link">Contact</a></li>
          <li class="nav-item cart"><a href="cart" class="nav-link"><span class="icon icon-shopping_cart"></span><span class="bag d-flex justify-content-center align-items-center"><small>1</small></span></a></li>
          <li class="nav-item"><a href="login" class="nav-link">Connexion</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- END nav -->

  <!-- Slider Section -->
  <section class="home-slider owl-carousel">
    <div class="slider-item" style="background-image: url(assets/front/images/bg_3.jpg);" data-stellar-background-ratio="0.5">
      <div class="overlay"></div>
      <div class="container">
        <div class="row slider-text justify-content-center align-items-center">
          <div class="col-md-7 col-sm-12 text-center ftco-animate">
            <h1 class="mb-3 mt-5 bread">Réservation</h1>
            <p class="breadcrumbs"><span class="mr-2"><a href="index.html">Home</a></span> <span>Réservation</span></p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Event Details Section -->
  <section class="ftco-about d-md-flex">
    <div class="one-half img" style="background-image: url(assets/front/images/27.jpg);"></div>
    <div class="one-half ftco-animate">
      <div class="overlap">
        <div class="heading-section ftco-animate ">
          <h2 class="mb-4">Soirée de lecture et débat littéraire</h2>
          <span class="subheading">Avril 7, 2025 | Lundi, 19:00</span>
        </div>
        <div>
          <br>
          <br>
          <p>Dans un coin feutré de notre café culturel, une trentaine de passionnés se retrouvent
             autour d’un livre récemment publié : Les cendres de Carthage, un roman mêlant histoire et fiction. 
             L’auteur, Abdelaziz Belkhodia, est présente pour échanger avec les lecteurs. Après une lecture d’extraits marquants, 
             le débat s’anime : certains applaudissent la vision du passé, d’autres soulèvent des critiques 
             sur l’interprétation des faits historiques. L’ambiance reste conviviale, agrémentée d’un café épicé
              typiquement tunisien. La rencontre se termine par une séance de dédicace où chacun repart avec un mot 
              personnalisé de l’auteur.</p>
        </div>
      </div>
    </div>
  </section>
  <br>
  <br>

  <!-- Reservation Title -->
  <section>
    <div class="row slider-text justify-content-center align-items-center" data-scrollax-parent="true">
      <div class="col-md-8 col-sm-12 text-center ftco-animate">
        <h1 class="mb-4">Débutez votre réservation avec nous</h1>
      </div>
    </div>
  </section>

  <!-- Multi-Step Reservation Form -->
  <section class="ftco-section contact-section">
    <div class="container mt-5">
      <!-- Progress Bar -->
      <div class="progress mb-4" style="height: 30px; border-radius: 15px; overflow: hidden;">
        <div class="progress-bar custom-progress-bar" role="progressbar"  style="width: 33%; font-size: 16px; line-height: 30px;" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">Étape 1</div>
      </div>

      <div class="row">
        <!-- Main Form Content (Left Side) -->
        <div class="col-xl-8">
          <!-- Step 1: Personal Information -->
<div id="step1" class="step active">
    {{ form_start(form, {'attr': {'class': 'billing-form ftco-bg-dark p-3 p-md-5','novalidate': 'novalidate'}}) }}
        <h3 class="mb-4 billing-heading">Étape 1 : Informations Personnelles</h3>
        <div class="row align-items-end">
            <!-- Prénom -->
            <div class="col-md-6">
                <div class="form-group">
                    {{ form_label(form.prenom_user, 'Prénom') }}
                    {{ form_widget(form.prenom_user, {'attr': {'class': 'form-control', 'placeholder': 'Votre prénom'}}) }}
                    {{ form_errors(form.prenom_user) }}
                </div>
            </div>

            <!-- Nom -->
            <div class="col-md-6">
                <div class="form-group">
                    {{ form_label(form.nom_user, 'Nom') }}
                    {{ form_widget(form.nom_user, {'attr': {'class': 'form-control', 'placeholder': 'Votre nom'}}) }}
                    {{ form_errors(form.nom_user) }}
                </div>
            </div>

            <div class="w-100"></div>

            <!-- Email -->
            <div class="col-md-6">
                <div class="form-group">
                    {{ form_label(form.email_user, 'Email') }}
                    {{ form_widget(form.email_user, {'attr': {'class': 'form-control', 'placeholder': 'Votre email'}}) }}
                    {{ form_errors(form.email_user) }}
                </div>
            </div>

            <!-- Téléphone -->
            <div class="col-md-6">
                <div class="form-group">
                    {{ form_label(form.telephone_user, 'Téléphone') }}
                    {{ form_widget(form.telephone_user, {'attr': {'class': 'form-control', 'placeholder': 'Votre téléphone'}}) }}
                    {{ form_errors(form.telephone_user) }}
                </div>
            </div>

            <div class="w-100"></div>

            <!-- Adresse & Date de naissance on the same row -->
            <div class="col-md-6">
                <div class="form-group">
                    {{ form_label(form.adresse, 'Adresse') }}
                    {{ form_widget(form.adresse, {'attr': {'class': 'form-control', 'placeholder': 'Votre adresse'}}) }}
                    {{ form_errors(form.adresse) }}
                </div>
            </div>

            <div class="col-md-6">
                <div class="form-group">
                    {{ form_label(form.dateNaissance_user, 'Date de naissance') }}
                    {{ form_widget(form.dateNaissance_user, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.dateNaissance_user) }}
                </div>
            </div>

            <div class="w-100"></div>

            <!-- Bouton Suivant inside the form -->
            <div class="col-md-12 text-center mt-4">
                <button type="button" class="btn btn-success next-step" data-next="step2">Suivant</button>
            </div>
        </div>
    {{ form_end(form, {'render_rest': false}) }}
</div>


          <!-- Step 2: Number of Places -->
          <div id="step2" class="step">
            <form id="placesForm" class="billing-form ftco-bg-dark p-3 p-md-5">
              <h3 class="mb-4 billing-heading">Étape 2 : Nombre de Places</h3>
              <div class="form-group">
                <label for="places">Nombre de Places :</label>
                <input type="number" class="form-control" id="places" min="1" required>
              </div>
              
              <div class="form-group">
                <button type="button" class="btn btn-secondary prev-step" data-prev="step1">Précédent</button>
                <button type="button" class="btn btn-success next-step" data-next="step3">Suivant</button>
              </div>
            </form>
          </div>

          <!-- Step 3: Payment -->
          <div id="step3" class="step">
            <form id="paymentForm" class="billing-form ftco-bg-dark p-3 p-md-5">
              <h3 class="mb-4 billing-heading">Étape 3 : Paiement</h3>
              <div class="form-group">
                <label for="cardNumber">Numéro de Carte :</label>
                <input type="text" class="form-control" id="cardNumber" required>
              </div>
              <div class="form-group">
                <label for="expiryDate">Date d'Expiration :</label>
                <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY" required>
              </div>
              <h3 class="billing-heading mb-4">Méthode de Paiement</h3>
              <div class="form-group">
                <div class="col-md-12">
                  <div class="radio">
                    <label><input type="radio" name="optradio" class="mr-2"> Virement Bancaire</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <div class="col-md-12">
                  <div class="radio">
                    <label><input type="radio" name="optradio" class="mr-2"> Paiement par Chèque</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <div class="col-md-12">
                  <div class="radio">
                    <label><input type="radio" name="optradio" class="mr-2"> Paypal</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <div class="col-md-12">
                  <div class="checkbox">
                    <label><input type="checkbox" value="" class="mr-2"> J'ai lu et j'accepte les termes et conditions</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <button type="button" class="btn btn-secondary prev-step" data-prev="step2">Précédent</button>
                <button type="submit" class="btn btn-success">Payer</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Sidebar (Right Side) -->
        <div class="col-xl-4 sidebar ftco-animate">
          <div class="sidebar-box ftco-animate">
            <div class="categories">
              <h3>Vous pouvez gérer vos réservations</h3>
              <ul>
                <li>
                  <a href="#" data-toggle="modal" data-target="#reservationModal">Consulter vos Réservations</a>
                </li>
                <li><a href="reservation/new" >Ajouter une Réservation</a></li>
                <li><a href="#" data-toggle="modal" data-target="#reservationModal">Modifier une Réservation</a></li>
                <li><a href="#" data-toggle="modal" data-target="#reservationModal">Annuler une Réservation</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="ftco-footer ftco-section img">
    <div class="overlay"></div>
    <div class="container">
      <!-- Footer Content Here -->
    </div>
  </footer>

  <!-- Custom CSS for Multi-Step Form -->
  <!-- Custom CSS for Multi-Step Form -->
  <style>
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    .progress-bar {
      transition: width 0.5s ease;
    }
    .btn-success {
      background-color:#c49b63;
      border-color: #c49b63;
    }
    .btn-success:hover {
      background-color: #c49b63;
      border-color: #c49b63;
    }
    .progress {
    }
    .progress-bar {
      background-color: #c49b63;
    }
    .billing-form {
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .form-control {
      border-radius: 5px;
      border: 1px solid #ced4da;
    }
    .form-control:focus {
      border-color: #80bdff;
      box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
  </style>

  <!-- JavaScript for Step Navigation -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const steps = document.querySelectorAll(".step");
      const nextButtons = document.querySelectorAll(".next-step");
      const prevButtons = document.querySelectorAll(".prev-step");
      const progressBar = document.querySelector(".progress-bar");

      // Function to go to the next step
      nextButtons.forEach((button) => {
        button.addEventListener("click", function () {
          const currentStep = this.closest(".step");
          const nextStepId = this.getAttribute("data-next");
          const nextStep = document.getElementById(nextStepId);

          if (currentStep && nextStep) {
            currentStep.classList.remove("active");
            nextStep.classList.add("active");
            updateProgressBar(nextStepId);
          }
        });
      });

      // Function to go to the previous step
      prevButtons.forEach((button) => {
        button.addEventListener("click", function () {
          const currentStep = this.closest(".step");
          const prevStepId = this.getAttribute("data-prev");
          const prevStep = document.getElementById(prevStepId);

          if (currentStep && prevStep) {
            currentStep.classList.remove("active");
            prevStep.classList.add("active");
            updateProgressBar(prevStepId);
          }
        });
      });

      // Function to update the progress bar
      function updateProgressBar(stepId) {
        let progress = 0;
        switch (stepId) {
          case "step1":
            progress = 33;
            break;
          case "step2":
            progress = 66;
            break;
          case "step3":
            progress = 100;
            break;
        }
        progressBar.style.width = `${progress}%`;
        progressBar.textContent = `Étape ${stepId.replace("step", "")}`;
      }

      // Show the first step on page load
      steps[0].classList.add("active");
      updateProgressBar("step1");
    });
  </script>

<!-- Modal for Consulter les Réservations -->
<div class="modal fade" id="reservationModal" tabindex="-1" aria-labelledby="reservationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="reservationModalLabel">Vos Réservations</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <div class="table-responsive"> <!-- Add this for horizontal scrolling -->
          <table class="table table-striped table-bordered table-hover" style="font-size: 0.9em;">
            <thead class="thead-dark">
              <tr>
                <th>Événement Réservé</th>
                <th>Date de réservation</th>
                <th>Nombre de places</th>
                <th>Statut</th>
                <th>Moyen de Paiement</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for reservation in reservations %}
                <tr>
                  <td>{{ reservation.evenement.titreEvenement }}</td>
                  <td>{{ reservation.dateBooking ? reservation.dateBooking|date('Y-m-d') : '' }}</td>
                  <td>{{ reservation.nbrPlaces }}</td>
                  <td>
                    {% if reservation.statutBooking == 'Confirmé' %}
                      <span class="badge badge-success">Confirmé</span>
                    {% elseif reservation.statutBooking == 'En attente' %}
                      <span class="badge badge-warning">En attente</span>
                    {% elseif reservation.statutBooking == 'Annulé' %}
                      <span class="badge badge-danger">Annulé</span>
                    {% else %}
                      <span class="badge badge-secondary">{{ reservation.statutBooking }}</span>
                    {% endif %}
                  </td>
                  <td>{{ reservation.moyenPayementBooking }}</td>
                  <td>
                    <a href="{{ path('app_reservation_edit', {'id': reservation.id}) }}" class="btn btn-warning btn-sm">
                      <i class="icon-pencil"></i> <!-- Edit icon -->
                    </a>
                    <a href="{{ path('app_reservation_delete', {'id': reservation.id}) }}" class="btn btn-danger btn-sm">
                      <i class="icon-trash"></i> <!-- Delete icon -->
                    </a>
                  </td>
                </tr>
              {% else %}
                <tr>
                  <td colspan="6" class="text-center">Aucune réservation trouvée</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div> <!-- End of table-responsive -->
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}